1. 数据
2. 数据库
3. 数据库管理系统
4. 数据库系统  

数据的含义：数据的语义
数据的解释
数据是有格式的
记录，record

数据库：长期存储，有组织、可共享、大量的数据的集合。
ddms：
    1. 数据的定义；
    2. 数据组织
    3. 数据操作功能；DML
    4. 数据库的事务管理和运行管理；安全性、完整性、多用户并发、故障的恢复
    5. 数据库的建立和维护功能；批量装在，介质故障恢复
    6. 其他功能；通信、格式转换、异构数据库互访和互操作
dbs：在cs中引入数据库后的系统构成
    1. 数据库   
    2. dbms  
    3. 应用程序
    4. dba
数据管理的阶段
    1. 人工  
    2. 文件系统  
    3. 数据库系统；磁盘阵列  

数据存储  
    额外信息；位置，长度
查询数据  

数据模型；数据项  
数据独立性高：物理存储独立，逻辑独立性--二级映射    


1.2 数据模型（dbs的核心）  
    - 是对现实世界数据特征的抽象
        - 真实模拟现实
        - 容易为人所理解
        - 便于在计算机上实现  
    - 2类数据模型  
        - 概念模型，信息模型：按用户的观点对数据和信息建模
        - 逻辑模型和物理模型  
            - 网状
            - 层次  格式化的
            - 关系模型；Relational
            - 面向对象数据模型
            - 对象关系数据模型
            - 半结构化数据模型
    - 信息世界中的基本概念
        - 实体
        - 属性
        - 码Key
        - 实体型
        - 实体集
    - 联系  
        - 实体各属性之间的联系
        - 实体之间的联系：1:1；1：m；m:n；  
        - 概念模型：Entity-Relationship Approach E-R图

1.2.3 数据模型的组成要素  
    - 组成：
        1. 数据结构：数据结构的类型
        2. 出具操作
            - 数据操作的类型：更新、查询
            - 数据操作语言:查询语言QL；更新语言DML
        3. 完整性约束  
            - 制约和依存规则；用以限定复合数据模型的数据库状态以及状态的变化。  
1.2.4 常用的数据模型  
     - 格式化模型：基本层次联系  双亲节点、子女节点
     - 层次模型的定义：
        1. 有且只有一个节点没有双亲节点，成为根节点
        2. 根以外的其他节点有且只有一个双亲节点  
     - 网状模型  有多种联系 DDL、DML语言复杂
        1. 允许一个以上的节点无双亲
        2. 一个节点可以有多余一个双亲  
        - 如何处理多对多联系：将多对联系分解为一对多的联系；引进一个联结记录
        - 导航式的查询语言和增删改查操作语言
        - 完整性约束
        - 属集类别
        - 记录之间的联系通过存取路径实现，负担。
    - 关系模型  
        - 在用户的观点下，关系模型的逻辑结构是一张**二维表**  
        - 数据结构  
            - 关系：一张表  
            - 元组：一行  
            - 属性：一列
            - 主码key：唯一  
            - 域：一组具有相同数据类型的值的集合，属性的范围来自某个域
            - 分量：元组中一个属性的值  
            - 关系模式：对关系的描述  关系名（属性1，属性2，...）关系必须是规范化的；不允许表中有表 
            
            - 数据的操作：操作对象和操作结果都是关系 - 提高了数据的独立性
    ·       - 关系完整性约束条件：实体完整性、参照完整性

1.3 数据库系统的结构  
    - 单用户结构
    - 主从式结构
    - 分布式结构
    - 客户-服务器
    - web-应用服务器/数据库服务器（三级结构）  

    - 模式schema
    - 实例 

    - 三级模式  
        - 模式：全体数据的逻辑结构和特征描述，DDL语句 
        - 定义模式：定义数据的逻辑结构，以某种数据模型为基础；定义数据联系；定义数据有关的安全性、完整性要求  
 
    - 外模式（子模式或用户模式）  模式的子集
    - 内模式：存储方式，顺序、堆存储、hash；索引的方式B+、bitmap、Hash；是否压缩；是否加密；定长、边长
    - 二级映像mapping：外模式/模式，数据的逻辑独立性；模式/内模式，数据的物理独立性  
    - 以数据为中心  

1.4 数据库系统的组成  
- 数据库  
    - 大内存
    - 足够大磁盘或磁盘阵列  
    - 较高的通道能力，提高数据传送率  
- 数据库管理系统，开发工具  
- 应用程序
- 数据库管理员  
    - 监视审计文件  
    - 日志

### 第二章 关系数据库  
1. 简介  
    E.F.Codd，1970基于关系模型，关系代数、关系演算  
    - 单一的数据结构---关系  
    - 域：一组具有相同数据类型的集合  
    - 笛卡尔积：给定一组域，D1、D2，……，笛卡尔积为D1xD2X……，所有域的所有取值的任意组合，关系的域。
    - 基数，M，表 
    -
1.1. 关系  
    1. 关系：R（D1,D2,D3）;R关系名，n关系的目或度degree
    2. 元祖，n元祖，t
    3. 属性 列
    4. 吗 
    5. 单元关系与二元关系  
    6. 分量必须取原子值
    7. 外码 专业号是学生的外码  
1.2 关系模式  
    1. 什么是关系模式
        - 五元组 R(U,D,Dom,F)
    2. 如何定义
    3. 与关系的关系  

1.3 关系的三类完整性约束  
    - 实体完整性
        - 关系的主属性不能取空值
    - 参照完整性  
        - 关系和关系之间的引用  
        - 选修关系为参照关系  
    
    - 用户定义的完整性 

2. 关系代数：是一种抽象的查询语言，它用对关系的运算来表达查询  
    - 关系代数语言：用对关系的运算来表达查询的要求 
    - 关系演算语言：用谓词来表达查询的要求  
    - 具有关系代数和关系演算双重特点的语言  SQL

2.1 
    - 运算对象是关系
    - 运算结果是关系
    - 运算符有2类：
        - 集合运算符：并、交、差、笛卡尔积
        - 关系运算符：选择、投影、连接、除
2.2 一些记号
    
2.3 运算
    1. 并Union：RUS
    2. 差Difference R-S
    3. 交Intersection R∩S 
    4. 笛卡尔积Cartesian Product RXS m+n目的

2.4 专门的关系运算  
    1. 选择Selection，Restriction
    2. 投影Projection：π（R）：从R中选择若干列属性组成新的关系
        - 投影关系主要是从列的角度进行运算
        - 投影之后不仅取消了原关系中的某些列，而且有可能取消某些元祖（避免重复行）
    3. 连接Join：R连接S
        - 等值连接 =
        - 自然连接
        - 外连接：左外连接、右外连接    
    4. 除运算Division R÷S  
2.5 举例  
    - 输入-输出分析法  

3. 关系演算  
3.1 以数理逻辑中的谓词演算为基础  
- 分类：按照谓词变元不同  
    - 元祖关系演算：元祖变量
        - alhpa
        - GET 工作空间名（定额）（表达式1）[:条件][DOWN|UP表达式2]
        - 元祖变量的含义：表示可以在某一关系范围内变化  
        - 元组变量的用途：简化关系名
        - 定义元组变量：格式，，RANGE 关系名 变量名  
            - 前束范式  
        - 用蕴含的检索  Implication  
        - 聚集函数  Aggregate Function：Count Ave
    - 域关系演算：域变量  QBE  Query by Example  

| 关系名  | 属性名   |      |      |
|------|-------|------|------|
| 操作指令 | 元组属性值 | 查询条件 | 操作指令 |  

P.
AO.
DO.  

### 第三章 关系数据库标准语言SQL  
3.1  
    - 综合统一，
        - 定义语言DDL、数据操纵语言DML，数据控制语言DCL
        - 可以独立完成和数据库生命周期中的全部活动  。
    - 高度非过程化
    - 面向集合的操作方式  
    - 同一种语法结构提供多种使用方式：独立语言、嵌入语言  
    - 语言简洁、易学易用  
        - 功能极强，核心功能9个动词  

| SQL功能 | 动词     |
|-------|--------|
| 数据查询  | SELECT |
| 定义      | CREATE，DROP，ALTER|
| 操纵      | INSERT，UPDATE，DELETE|
| 控制      | GRANT，REVOKE|

    - SQL支持关系数据库的三级模式结构  
    - 基本表  
        - 本身独立存在
        - SQL中的一个关系对应一个基本表  
        - 一个表对应一个存储文件  
        - 一个表可以带若干索引  
    - 存储文件  
    - 视图  一个虚表  


3.2 数据定义  
- SQL的数据定义语句  

| 操作对象 | 创建            | 删除   | 修改    |
|------|---------------|------|-------|
| 模式   | CREATE SCHEMA | DROP |       |
| 表    | CREATE TABLE  | DROP | ALTER |
| 视图   | CREATE VIEW   | DROP |       |
| 索引   | CREATE INDEX  | DROP | ALTER |

- 层次化的数据库命名机制：一个数据库可建立多个模式，一个模式通常包含多个表、视图、索引  
- 语句->SQL语言翻译与处理->数据字典（以表的方式存储）  
- 数据字典：模式、表的定义、完整性约束、权限、统计信息  

    1. 模式定义
        - CREATE SCHEMA AUTHORIZATION WANG；模式名缺省  
        - CREATE SCHEMA “S-T” AUTHORIZATION WANG；
        - 定义了命名空间，或目录  
        - DROP SCHEMA <模式名> <CASCADE|RESTRICT> 级联：限制
    2. 表定义  
        - CREATE TABLE TAB1 （COL1 SMALLINR PRIMARY KEY,
                                COL2 INT UNIQUE,
                                Cpno CHART（4）,
                                FOREIGN KEY （Cpno）REFERENCES Course(Cno)
                                ）;
        - 列级完整性约束  
        - 表级完整性约束 ；实体完整性；参照完整性   
        - 数据类型，“域”  
        - 模式与表  
            - 在表名中显示给出
            - 在创建模式同时创建表
            - 设置所属的模式  SET search_path “S-T”，PUBLIC  
    3. 索引定义  
        - 建立索引的目的：加快查询速度
        - CREATE [UNIQUE][CLUSTER]INDEX <索引名> ON <表名>(<列名>[<次序>]);
        - primary key；系统会自动建立索引  
        - ALTER INDEX <旧索引名> RENAME TO <新索引名>  
        - DROP INDEX <索引名>;
        - 常见索引：
            - 顺序文件上的索引  
            - B+数索引  动态平衡  
            - hash索引  查找快速  
            - 位图索引  

3.3 数据查询  
3.3.1 单表查询  

- 语句格式  
~~~
SELECT [ALL|DISTINCT去重]<目标列表达式>[,<目标表达式>]
FROM
[WHERE]
[GROUP BY <列名1>[HAVING <条件表达式>]]
[ORDER BY <列名2>[ASC|DESC]]；
~~~
- 条件
    1. 比较  = > < ...
    2. 确定范围  BETWEEN AND，NOT BETWEEN AND
    3. 确定集合  IN，NOT IN  
    4. 字符匹配  LIKE，NOT LIKE
        - %
        - _
        - ESCAPE '\'
    5. 空值 IS NULL
    6. 多重条件  AND，OR，NOT
    
- 别名：空格+别名  
- 谓词：
    - IN <值表>, NOT IN <值表>  
    - BETWEEN AND，NOT BETWEEN AND  
- 聚集函数  
    1. 统计COUNT
    2. 统计一列中值的个数  
    3. 计算一列的总和 SUM
    4. 计算一列值的平均值 AVG 
    5. 求一列中的最大值和最小值  MAX MIN  
- GROUP BY 子句  

3.1.2 连接查询  
- 等值连接： “=”  
    - 嵌套循环  
        - 不相关子查询 IN
        - 相关子查询  
            - 集合IN、单值 =、
            - 谓词：存在量词、全称量词、ANY、ALL、EXIST（产生true、false）
        
    - 排序合并  
    - 索引连接  
- 自身连接  使用别名  
- 外连接  LEFT OUT JOIN ON  
- 多表连接  
3.1.2 集合查询  
1. 并操作UNION
2. 交INTERSECT
3. 差EXCEPT  

3.1.3 空值  
- 不知道、不存在、无意义  
- 判断 IS NULL、IS NOT NULL  
- 运算  
    - 空值和另一个值算术运算结果为空值  
    - 空值和另一个比较运算结果为UNKNOW
    - 二值逻辑变为三值逻辑（TRUE、FALSE、UNKNOW）  


3.5 数据更新  
1. 插入  
- 将新元组插入指定表中  
INSERT
INTO <表名>
VALUES 
- 符号串用单引号，数字直接
2. 修改  
UPDATE <表名>  
SET <列名>=<表达式>
[WHERE <条件>];

WHERE：修改指定表中满足where子句条件的元组  
3. 删除  
UPDATE <表名>  
[WHERE <条件>];  

3.7 视图  
1. 建立视图  
CREATE VIEW  
AS
WITH CHECK OPTION

- CREAT VIEW 时，只是把视图定义存入字典，不执行SELECT语句，在对视图查询时，才执行  

- 行列子集视图：从单个基本表导出，保留了主码

- 基于视图的视图  
- 分组视图  
- 视图消解法  
- 子模式  

### 第四章  数据库安全性  

共享特性

4.1 安全性概述  
    - 三个问题
        - 非授权--用户身份鉴别、存取控制和视图
        - 敏感数据--强制存取控制、数据加密存储、加密传输、审计  
        - 安全环境的脆弱性  
    - 安全标准  
        - TCSEC、TDI（A1、B3、B2、B1、C2、C1、D）DOs是d级
        - CC（EAL1-7）评估保证级
4.2 安全性控制 （自主存取控制DAC、强制存取控制MAC） 
    - 用户身份鉴别  
    - 存取控制 - 数据字典 
        - 定义用户权限
        - 合法权限检查  
    - GRANT指定对象授予对象权限、REVOKE
    - 授权与回收  
        - 不允许循环授权
        - 可以传播权限
    - 数据库角色：被命名的一组与数据库操作相关的权限  
        - 角色是权限的集合
        - 具有相同权限的用户创建一个角色
        - 简化授权的过程    
    - 强制存取控制MAC  
        - 主体，许可证、客体，密级  
        - 敏感度标记Label
        - 强制存取控制住规则
            - 读  
            - 写
~~~
GRANT 
ON
TO

REVOKE
ON
FROM
CASADE RESREICT

CREAT ROLE


~~~
4.3 视图机制  
4.4 审计AUDit
    - 服务器事件
    - 系统权限  
    - 语句事件
    - 模式对象事件 
4.5 数据加密  
    - 存储和传输中失密的有效手段  
    - 存储加密
        - 透明
    - 传输加密
        - 链路加密
        - 端到端加密
4.6 其他安全性保护      
    - 推理控制  
        - 基于函数依赖
        - 基于敏感关联  
    - 隐秘信道  

### 第五章 完整性  
- 正确性
- 相容性  

- 防止存在不符合语义的数据、不正确
= 防止非法用户和非法操作  

1. 定义完整性约束条件的机制  
2. 提供完整性检查机制  
3. 违约处理  
    - 拒绝
    - 级联  

5.1 实体完整性  
列级、表级  
检查：插入和更新时
- 全表扫描
- 自动建立 UNIQUE索引  
5.2 参照完整性  
增、删除、改会触发。

拒绝、级联操作、设置空值。
5.3 用户定义完整性  
- 列值非空NOT NULL
- 列值唯一UNIQUE
- 是否满足一个条件表达式CHECK
 
- 元组上的约束 
- 属性上的约束  
5.4 完整性约束命名子句  
CONSTRAINT 
修改ALTER TABLE

5.5 断言  
CREATE ASSERTION  
DROP ASSERTION  

5.6 触发器
- 用户定义在关系表上的一类由事件触发的机制  

- 定义  
CREATE TRIGGER

事件-条件-动作  


### 第六章 关系数据理论  

1. 关系化规范理论  

6.1 为什么关系数据理论  
    - 数据冗余  
    - 更新异常  
    - 插入异常  
    - 删除异常  

    - 数据依赖原因导致的  

    - 什么是数据依赖：函数依赖，
        1. 完整性约束的一种表现  
        2. 数据依赖  
        3. 数据依赖的主要类型：函数依赖FD，多值依赖MVD，连接依赖  
        4. 数据依赖对关系模式的映像  
    - 关系模式的简化表示  
        - R(U,D,DOM,F)
        - R<U,F>
6.2 规范化      
    6.2.1 函数依赖
        1. 函数依赖：X函数确定Y，Y函数依赖X，记作X→Y；X成为函数依赖的决定属性组，决定因素  
            是根据数据的语义来确定函数依赖，任何时刻。  
        2. 平凡函数依赖（X包含Y）与非平凡函数依赖  
        3. 完全函数依赖，部分函数依赖  X→fY X→pY  
        4. 传递函数依赖  X→传递Y  
    6.2.2 码  
        1. 候选码  超码  主码  
        - 主属性、
        - 非主属性  
        - 全码  
        - 外码
    6.2.3 范式  
        1. 范式是符合某一种级别的关系模式的集合  
        2. 关系数据库中的关系必须满足一定的要求，满足不同程度要求的为不同范式。
        3. 范式的种类：
            - 第一范式：如果一个关系模式R的所有属性都是不可分割的基本数据项1NF 
 
            - 第二范式：若关系模型R属于1NF，并且每一个非主属性都 **完全依赖** 于R的码。 
                消除非主属性对码的部分函数依赖，投影法分解为多个2NF的关系模式  
                但是存在传递函数依赖  
            - 第三范式：对于R，不存在XYZ，使得X->Y，Y->Z，y-\>X成立 
            - BC范式：Boyce Codd Normal Form：对于R，如果每一个决定因素都包含码，则R∈BCNF 
            - 第五范式  

- 规范化就是概念的单一化，一事一地      
6.3 公理
> 数据依赖的公理系统是模式分解算法理论基础  
> 函数依赖的一个有效而完备的公理系统--Armstrong公理系统  
1. Armstrong公理
    - 自反率
    - 曾广律
    - 传递律  
    
    - 合并规则
    - 伪传递
    - 分解规则  
2. 闭包 F+
3. X关于函数依赖集F的闭包Xf+
4. 函数依赖集等价==闭包等价  
5. 最小依赖集，最小覆盖    

6.4 模式分解  
> 分解的无损连接性，没有丢失信息   无损分解  
> 分解要保持函数依赖

1. 分解算法


### 第七章 数据库设计  



### 第八章 嵌入式SQL  
1. SQL语言的局限性  
    - 利用高级语言的表达能力：嵌入式SQL  
    - 扩展SQL语言对于过程控制的表达能力
    - 数据库看做是一类数据源：ODBC  
2. EXEC SQL 
    - 含有嵌入式SQL语句的主语言程序
    - 预编译程序转换嵌入式SQL语句为 **函数调用**，数据库厂商提供的预编译程序   
    - 转换后的主程序（形式上消除了SQL）  
    - 主语言编译程序编译主语言
    - 目标语言程序  
3. 主语言访问数据库的基本步骤  
    1. 打开数据库  
        - EXEC SQL CONNECT TO target [AS connection-name] [USER user-name]
    2. 定义必要的 **主变量** 和 **数据通信区**   
~~~
EXEC SQL BEGIN DECLARE SECTION;
    char Deptname[20];
EXEC SQL END DECLARE SECTION;
long SQLCODE;
EXEC SQL INCLUDE SQLCA;
~~~  


    3. 用SQL访问数据库，对结果进行处理 
        - 执行 
        - 定义CREATE
        - 数据控制语句 GRANT，REVOKE，COMMIT，ROBACK
        - 更新UPDATE，INSERT，DELETE
        - 查询语句SELECT

        - 增加INTO子句，用于保存查询结果，INTO：Hson，
    4. 关闭数据库  
        - EXEC SQL DISCONNECT [connection];

8.2 通信机制  
- 主程序与数据库工作单元的通信  
    1. 向主语言传递SQL语句的执行状态信息，使主语言能够据此控制程序流程，主要用SQL通信区实现  
    2. 主语句向SQL语句提供参数，主变量
    3. 将SQL语句查询数据库返回给主语言，主变量和游标实现。
1. SQLCA
    - 过程
        - SQL执行后，系统反馈给应用程序的信息：系统当前工作状态，描述运行环境  
        - 信息送到SQL通信区
        - 应用程序从SQL通信区取出状态，决定接下来执行的语句  
    - 是一个数据结构  struct sqlca_t；
    - 使用方法
        - 定义SQLCA 用include    
        - 使用，存放有一个每次中子星sql语句后返回代码的变量SQLCODE；SUCCESS    
2. 主变量  host var
    - 输入
    - 输出
3. 指示变量  
    - 是一个整形变量，用来“指示”所指主变量的值或条件  
    - 一个主变量可以附带一个指示变量Indicator Var
    - 用途
        - 指示输入主变量是否位空值
        - 检测输出是否位空值，值是否被截断  
        - INTO：Hgrade：Gradeid Gradeid < 0;则Hgrade认为是空值  
4. 游标  
    - 游标是数据库为用户开设的一个数据缓冲区，存放SQL语句的执行结果  
    - 每个游标区都有一个名字，理解为指针
    - 可以用SQL语句逐一从游标获取记录，

    - 定义  
    EXEC SQL DECLARE <游标名> CURSOR
        FOR <SELECT 语句>
    - 说明：不执行语句，而是从系统申请一个数据空间，用来存放select的结果数据集。  
    - SQL面向集合，主语言面向记录，一组主变量只能存放一条记录  
    - 打开游标
        EXEC SQL OPEN SX；

    - 使用游标
        1. 声明游标
        2. 打开游标
            - 执行响应的SELECT语句，把查询结果取到缓冲区中，
            - 这时游标处于活动状态，指针指向查询结果集中的第一条记录
        3. 推进游标指针并取当前记录  
            - EXEC SQL FETCH <游标名>
                INTO <主变量>[<指示变量>]...
        4. 关闭游标  
            - EXEC SQL CLOSE <游标名>
            - 关闭游标，释放结果占用的缓冲区和其他资源。
            - CURRENT形式的UPDATE/DELETE-- WHERE CURRENT OF <游标名>  修改最近一次取出的记录  
            - 传递到数据库    
            - 提交更新：EXEC SQL COMMIT WORK；
5. 动态SQL  
    - 编译时无法获得完整的sql语句。
    1. SQL语句主变量  
        const char *stmt = "CREATE TABLE test(a int );"
        const char *stmt = INSERT INTO test VALUES(?);"
        EXEC SQL EXECUTE IMMEDIATE：stmt；
    2. 动态参数  参数符号？，通过PREPARE语句准备主变量和执行 语句EXECUTE绑定数据或主变量完成  
        EXEC SQL PREPARE mystmt FROM ：stmt；
        EXEC SQL EXECUTE mystmt USING 100；

8.3 过程化SQL  PL/SQL 
    - 基本结构是块Block
        - 块可以嵌套
        - 每个块完成一个逻辑操作
    - 增加了变量、常量等的定义
    - 增加了变量赋值语句  
    - 增加了流程控制语句  

1. 块的基本结构  
    - 定义部分：定义的变量、常量、游标、异常等只能在块中使用，
    - 执行部分  
        BEGIN
        EXCEPTION
        END；

        if then
        loop end loop  EXIT leave break
        for end for
2.  存储过程与函数  
    存储过程：由过程化SQL语句书写的一段程序，经编译和优化后，命名并存储在数据库服务器中，使用时只要调用即可。
    有点：运行效率高，降低sc的通信量，方便实施企业规则
    块类型：
        - 命名块：过程和函数是命名块
        - 匿名块：每次执行都要编译；不能存在数据库，也不能在其他过程SQL块中调用 
    存储过程的用户接口
        - 创建 CREATE PROCEDURE 过程名（） AS <过程化SQL块>
        - 执行 CALL/PERFROM 过程名
        - 修改 ALTER PROCEDURE 
        - 删除  
3. 函数和存储过程的区别  
    函数必须指定返回的类型  
        CREATE FUNCTION
        RETURNS

4. ODBC编程  
4.1 体系结构
    - 用户应用程序
        - 请求连接
        - 断开
        - 操作数据库以及获取数据库的执行状态  
    - ODBC驱动管理程序（ODBC应用程序编程接口）
        - ODBC32.dll                                                                                                         
    - 数据库驱动程序
    - 数据源  
4.2 优点
    - 移植性好
    - 一个应用中同时访问不同的数据库  
4.3 API
    - 连接句柄：连接某一个数据源    
    - 语句句柄：执行SQL语句 
    - 环境句柄：全局背景，环境状态、当前环境上的连接句柄等 
    - 描述符句柄  
    
    - ODBC 3.0 76个函数API
    - 句柄是个指针，

4.4 数据类型  
    - SQL数据类型：用于数据源
    - C数据类型：用于应用程序的dc代码

4.5 ODBC的工作流程  
    - 配置数据源
    - 初始化环境
        - 声明2个环境句柄变量
        - 创建2哥特环境句柄变量
        - 初始化
    - 连接数据源
    - 分配语句句柄
    - 执行SQL语句
    - 处理结果集
    - 终止  

### 第三篇 系统篇  

### 第14章 关系查询处理  

14.1 SQL查询处理步骤  
    - 查询分析：词法分析，语法分析  
    - 查询检查    
        - 有效性检查
        - 视图转换：视图消解法，把对视图的操作转换成对基本表的操作
        - 安全性检查
        - 完整性初步检查
        
        - 语法树
    - 查询优化
        - 代数优化
        - 逻辑优化，物理优化
    - 查询执行  
        - 关系代数的实现操作  
        ：选择操作的实现  
            - 全表扫描法：TABLE Scan
            - 索引扫描法：INDEX Scan
        ：连接操作的实现（等值连接）  
            - 嵌套循环法
            - 排序合并法
            - 索引连接法
            - Hash Join算法：划分阶段、试探阶段，hash

### 15. 关系查询的优化  

    - 优化器可以从数据字典中获得许多统计信息，
    - 数据库的物理统计信息改变了，系统可以自动对查询重新优化。
    - 优化器可以考虑数百种不同的执行计划，
    - 优化器中包括了很多复杂的优化技术，。

- 关系数据库管理系统通过某种代价模型计算出各种查询执行策略的代价。
    - 集中式数据库：
        - 执行开销：磁盘IO、处理机时间、内存空间的开销
    - 分布式数据库
        - 总代价：IO+cpu+内存+通信

- 代数优化：先选择再连接
    - 关系代数表达式的等价变换规则
    - 启发式规则：执行代价小的。  
        - 选择运算尽可能先做
        - 把投影运算和选择运算同事进行  
        - 把投影和其前和后的双目运算结合起来。
        - 选择和前面的笛卡尔积结合起来成为一个联结运算。
        - 找出公共子表达式，一次计算，多次使用
- 物理优化：通过索引扫描代替全表扫描   
    - 基于规则的启发式优化
    - 基于代价估算的优化
        - 统计
        - 代价估算
        - 优化方法

#### 10.7 故障

1. 介质故障
    - 数据库镜像：复制，关键数据和日志文件  
2. 事务故障
3. 系统故障：检查点技术

### 十一章 并发控制  

1. 多事务执行方式
    - 事务串行执行  
    - 交叉并发方式
    - 同时并发方式

2. 技术
    - locking
    - 时间戳，Timestamp
    - 乐观控制
    - 多版本并发控制

3. 锁
    - 类型：排他锁，X，写锁；共享锁，S，读锁；
    - 相容矩阵，对称
4. 封锁协议  
    - 三级封锁协议：一级、二级、三级
    - COMMIT ROLLBACK
    - 事务结束（长锁），读完释放（短锁）
    - 活锁-先来先服务
    - 死锁：预防、诊断、解除
        - 一次封锁法、顺序封锁法。
        - 诊断：超时法，等待图法：有向图，
        - 解除死锁：选择一个处理代价最小的事务，将其撤销。
5. 并发调度的可串行性
    - 冲突可串行化。
6. 两段锁协议：无冲突交换  
    - 获取锁阶段
    - 释放锁阶段
7. 锁的粒度

### 第十章 数据库恢复技术

事务处理：恢复和并发

事务：是用户定义的一个数据库操作序列，要么全做，要么全不做，是一个不可分割的工作单位。

定义事务：BEGIN TRANSACTION  COMMIT ROLLBACK

特性ACID特性：
    - 原子性Atomicity
    - 一直性Consistency
    - 隔离性Isolation
    - 持续性Durability
